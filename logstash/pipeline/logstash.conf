# ======================================
# INPUT: Filebeat env�a los logs JSON aqu�
# ======================================
input {
  beats {
    port => 5044
  }
}

# ======================================
# FILTER: parsea los logs JSON de Serilog
# ======================================
filter {
  # Convierte el mensaje JSON en campos individuales
  json {
    source => "message"
    target => "log"
    remove_field => ["message", "host", "path"]  # opcional: limpia campos innecesarios
  }

  # Formatea la fecha si tu JSON tiene un campo "Timestamp"
  date {
    match => ["log.Timestamp", "ISO8601"]
    target => "@timestamp"
    remove_field => ["log.Timestamp"]
  }

  # Puedes renombrar campos o agregar etiquetas si quieres
  mutate {
    rename => { "log.Level" => "level" }
    rename => { "log.MessageTemplate" => "message_template" }
    rename => { "log.Exception" => "exception" }
    rename => { "log.Properties" => "properties" }
  }
}

# ======================================
# OUTPUT: env�a a Elasticsearch
# ======================================
output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "useraccess-%{+YYYY.MM.dd}"  # �ndice diario
  }

  # Tambi�n imprime en consola para debug
  stdout { codec => rubydebug }
}

